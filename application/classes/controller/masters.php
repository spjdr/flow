<?php defined('SYSPATH') or die('No direct script access.');class Controller_Masters extends Controller_Website {    	public function before()  	{  		$this->auth_required = 'login';  		parent::before();  	}  	  	public function action_index()  	{  		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('uri'))->find();					$this->template->title = __('Flow masters');		$content = $this->template->content = new View('masters/index');		$content->flow = $flow;		$content->tags = $flow->masters->find_all();  	}  	  	public function action_add()	{		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('uri'))->find();					$this->template->title = __('Add flow masters');		$content = $this->template->content = new View('masters/add');		$content->flow = $flow;				if ($_POST)		{				$invitation = ORM::factory('invitation');						$post = $invitation->validate_create($_POST);						if ($post->check())			{				$invitation->master = 1;				$invitation->email = $post['email'];				$invitation->save();				$this->session->set('message',Kohana::message('masters','add_success')); 				#redirect to the flow				Request::instance()->redirect($flow->uri.'/masters');			}			else			{				$this->session->set('error',Kohana::message('masters','add_failed'));								#Get errors for display in view				$content->errors = $post->errors('masters');				$content->post = $post;			}		}	}		public function action_remove()	{		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('uri'))->find();		$master = $flow->masters->find(Request::instance()->param('id'));				$this->template->title = __('Rename tag');		$content = $this->template->content = new View('tags/rename');		$content->flow = $flow;		$content->tag = $tag;				if ($_POST)		{				$post = $_POST;			$post['flow_id'] = $tag->flow_id;			$post = $tag->validate_edit($post);						if ($post->check())			{				$tag->title = $post['title'];				$tag->save();															$this->session->set('message',Kohana::message('tags','edit_success'));	 				#redirect to the flow				Request::instance()->redirect($flow->uri.'/tags');			}			else			{				$this->session->set('error',Kohana::message('tags','edit_failed'));								#Get errors for display in view				$content->errors = $post->errors('flows');				$content->post = $post;			}		}	}		public function action_delete()	{		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('uri'))->find();		$tag = $flow->tags->find(Request::instance()->param('id'));				$this->template->title = __('Delete tag');		$content = $this->template->content = new View('tags/delete');		$content->flow = $flow;		$content->tag = $tag;				if ($_POST)		{				$tag->delete();						$this->session->set('message',Kohana::message('tags','delete_success')); 			#redirect to the flow			Request::instance()->redirect($flow->uri.'/tags');		}	}}