<?php defined('SYSPATH') or die('No direct script access.');class Controller_Invitations extends Controller_Website {    	public function before()  	{  		$this->auth_required = 'login';  		parent::before();  	}  	  	public function action_index()  	{  		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('flow'))->find();					$this->template->title = __('Invitations');		$content = $this->template->content = new View('invitations/index');		$content->flow = $flow;		$content->invitations = $flow->invitations->find_all();  	}  	  	public function action_new()	{		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('flow'))->find();				$this->template->title = __('New invitations');		$content = $this->template->content = new View('invitations/new');		$content->flow = $flow;				if ($_POST)		{				$invitations = isset($_POST['invitations']) ? array_unique($_POST['invitations']) : array();			unset($_POST['invitations']);						foreach($invitations as $email)			{				$invitation = ORM::factory('invitation');				$post = array_merge(array('email'=>$email),$_POST);				$post = $invitation->validate_create($post);								if ($post->check())				{					$invitation->values($post);					$invitation->save();					$invitations->send();				}			}						$this->session->set('message',Kohana::message('invitations','new_success')); 			#redirect to the flow			Request::instance()->redirect($flow->uri.'/invitations');		}	}		public function action_delete()	{		$flow = ORM::factory('flow')->where('uri','=',Request::instance()->param('flow'))->find();		$invitation = $flow->invitations->find(Request::instance()->param('email'));				$this->template->title = __('Delete invitation');		$content = $this->template->content = new View('invitations/delete');		$content->flow = $flow;		$content->invitation = $invitation;				if ($_POST)		{				$invitation->delete();						$this->session->set('message',Kohana::message('invitations','delete_success')); 			#redirect to the flow			Request::instance()->redirect($flow->uri.'/invitations');		}	}}