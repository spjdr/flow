<?php defined('SYSPATH') or die('No direct script access.');class Model_Stream extends ORM {  	protected $_has_many = array(		'events' 	=> array('model' => 'event'),		'editors'   => array('model' => 'user', 'through' => 'editors_streams'),		'invitations' => array('model' => 'invitation')	);		protected $_belongs_to = array(		'flow'		=> array('model'=>'flow')	);		protected $_rules = array(		'color' => array(			'not_empty'  => NULL,			'min_length' => array(6),			'max_length' => array(6),			'regex' => array('/[0-9a-fA-F]{6}/')		),		'title' => array(			'not_empty' => NULL,			'min_length' => array(4),			'max_length' => array(255)		),		'description' => array(			'not_empty' => NULL		),		'created_timestamp' => array(			'not_empty' => NULL		)	); 	public function validate_create(& $array) 	{		// Initialise the validation library and setup some rules				$array = Validate::factory($array)						->rules('color', $this->_rules['color'])						->rules('title', $this->_rules['title'])						->rules('description', $this->_rules['description'])						->filter('color', 'trim')						->filter('title', 'trim')						->filter('description', 'trim'); 		return $array;	}		public function validate_edit(& $array)	{			// Initialise the validation library and setup some rules				$array = Validate::factory($array)						->rules('color', $this->_rules['color'])						->rules('title', $this->_rules['title'])						->rules('description', $this->_rules['description'])						->filter('color', 'trim')						->filter('title', 'trim')						->filter('description', 'trim'); 		return $array;	}		public function save()	{		if (!parent::__isset('created_timestamp')) {			parent::__set('created_timestamp',time());		}				parent::save();	}	}