<?php defined('SYSPATH') or die('No direct script access.');class Model_Invitation extends ORM {  	protected $_belongs_to = array( 		'flow' => array(), 		'user' => array('model'=>'user','foreign_key' => 'sender_id') 	); 	 	protected $_rules = array( 		'secret' => array( 			'not_empty' => NULL, 		), 		'email' => array( 			'not_empty' => NULL, 			'email' => NULL, 		), 		'text' => array( 		) 	); 		public function validate_create(& $array) 	{		// Initialise the validation library and setup some rules				$array = Validate::factory($array)						->rules('secret', $this->_rules['secret'])						->rules('email', $this->_rules['email'])						->rules('text', $this->_rules['text'])						->filter('secret', 'trim')						->filter('email', 'trim')						->filter('text', 'trim');				return $array;	}		public function validate_edit(& $array)	{		// Initialise the validation library and setup some rules				$array = Validate::factory($array)						->rules('secret', $this->_rules['secret'])						->rules('email', $this->_rules['email'])						->rules('text', $this->_rules['text'])						->filter('secret', 'trim')						->filter('email', 'trim')						->filter('text', 'trim');				return $array;	}		public function save()	{		if (!parent::__isset('created_timestamp')) {			parent::__set('created_timestamp',time());		}				if (parent::__isset('secret')) {			parent::__set('secret',uniqid());		}			parent::save();	}		public function send()	{		if (!$this->_loaded)			throw new Kohana_Error('not_loaded');		if (!$this->_saved) {			$this->save();		}		$flow = ORM::factory('flow',parent::__get('flow_id'));		$sender = ORM::factory('user',parent::__get('sender_id'));		$email = parent::__get('email');		$secret = parent::__get('secret');		$text = parent::__get('text');			// Send email	}}